{% extends "auctions/layout.html" %}

{% block body %}
    <h2>
        Listing: {{ listing.title }}
        {% if not listing.active %}
        <span style="color: red">(Closed)</span>
        {% endif %}
    </h2>
    {% if listing.active and user == listing.owner %}
        <form action="{% url 'close' listing.id %}" method="POST">
            {% csrf_token %}
            <button class="btn btn-danger" type="submit">
                Close listing
            </button>
        </form>
    {% endif %}

    <div class="image-item">
        <img class="image" src="{{ listing.image_url }}" alt="Image of {{ listing.title }}">
    </div>
    <div class="listing-description">{{ listing.description }}</div>
    <h4 class="listing-price">
        ${{ listing.current_price }} 
        ({% if listing.last_bidder is not none %}
            by {{ listing.last_bidder.username }}
        {% else %}
            No bidder yet
        {% endif %})
    </h4>
    <div class="bid-info">
        {% if user == listing.owner %}
            Your listing has
        {% endif %}
        {{ listing.num_bids }} bid(s) so far. 
        {% if listing.last_bidder == user %}
            Your bid is the current bid.
        {% endif %}
    </div>

    {% if user != listing.owner and user != listing.last_bidder and listing.active %}
        <form action="{% url 'listings' listing.id %}" method="post">
            {% csrf_token %}
            {{ form }}
            <input class="btn btn-success place-bid-button" type="submit" value="Place Bid">
        </form>
    {% endif %}
    <h4 style="margin-top: 20px;">Details</h4>
    <ul>
        <li>Listed by <b>{{ listing.owner.username }}</b> at {{ listing.created_at}} (EST).</li>
        <li>Category: 
            {% if listing.category == "" %}
                No Category Listed
            {% else %}
                {{ listing.category }}
            {% endif %}
        </li>
    </ul>
{% endblock %}